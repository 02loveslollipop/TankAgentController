name: Build and Deploy Services

on:
  push:
    branches:
      - main

jobs:
  auth_service:
    uses: ./.github/workflows/service-pipeline.yml
    with:
      service_name: auth_service
      context: ./auth_service
      dockerfile: ./auth_service/Dockerfile
      image: registry.heroku.com/tank-auth-service/web
      test_command: "pytest auth_service/tests -q"
      workdir: /app
      push: true
      release_app: tank-auth-service
    secrets: inherit

  backend:
    uses: ./.github/workflows/service-pipeline.yml
    with:
      service_name: backend
      context: ./backend
      dockerfile: ./backend/Dockerfile
      image: registry.heroku.com/tank-backend-service/web
      test_command: "pytest tests -q"
      workdir: /app/backend
      push: true
      release_app: tank-backend-service
    secrets: inherit
