name: Test Builds

on:
  push:
    branches-ignore:
      - main
  pull_request:

jobs:
  auth_service:
    uses: ./.github/workflows/service-pipeline.yml
    with:
      service_name: auth_service
      context: ./auth_service
      dockerfile: ./auth_service/Dockerfile
      image: auth_service:test
      test_command: "pytest auth_service/tests -q"
      workdir: /app
      push: false

  backend:
    uses: ./.github/workflows/service-pipeline.yml
    with:
      service_name: backend
      context: ./backend
      dockerfile: ./backend/Dockerfile
      image: backend:test
      test_command: "pytest tests -q"
      workdir: /app/backend
      push: false
